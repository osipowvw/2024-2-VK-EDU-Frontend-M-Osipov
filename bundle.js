(()=>{"use strict";function e(e){var t=new Date(e),n=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return"".concat(n,":").concat(a)}document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("chat-list"),n=document.getElementById("messages-container"),a=document.getElementById("chat-list-screen"),s=document.getElementById("chat-screen"),c=document.getElementById("back-button"),i=document.getElementById("create-chat-button"),r=document.getElementById("new-chat-name"),o=document.getElementById("create-chat-modal"),d=document.getElementById("create-chat-confirm-button"),l=document.getElementById("create-chat-cancel-button"),u=document.getElementById("search-input"),m=document.getElementById("message-form"),g=document.getElementById("message-input"),f=document.getElementById("switch-user-button"),y=document.getElementById("user-name"),v=JSON.parse(localStorage.getItem("chats"))||[],h=JSON.parse(localStorage.getItem("messageContainers"))||{},p=null,E="Максим",S=!1,I="";function L(){t.innerHTML="",v.forEach((function(e){return w(e)}))}function w(e){var n=document.createElement("div");n.classList.add("chat-item"),n.innerHTML='\n            <div class="chat-info">\n                <h3>'.concat(e.name,"</h3>\n                <p>").concat(e.lastMessage||"Нет сообщений",'</p>\n            </div>\n            <div class="chat-time">').concat(e.time,'</div>\n            <span class="indicator ').concat(e.readStatus?"read":"unread",'"></span>\n        '),t.appendChild(n),n.addEventListener("click",(function(){return t=e.id,n=e.name,p=t,I=n,E="Максим",y.textContent=n,a.style.display="none",s.style.display="block",void B(t);var t,n}))}function B(t){n.innerHTML="",(h[t]||[]).forEach((function(t){var a=function(t){var n=t.sender,a=t.text,s=t.timestamp,c=document.createElement("div");c.classList.add("message"),n===E?c.classList.add("message-right"):c.classList.add("message-left"),c.classList.add("new-message"),c.innerHTML="\n            <strong>".concat(n,"</strong><br>\n            ").concat(a,'<br>\n            <span class="message-time">').concat(e(s),"</span>\n        ");var i=document.querySelector(".messages-container");return i.querySelectorAll(".message").forEach((function(e){e.classList.remove("new-message","show")})),i.appendChild(c),setTimeout((function(){c.classList.add("show"),c.classList.remove("new-message")}),300),c}(t);n.appendChild(a)})),b()}function b(){var e=n.querySelectorAll(".message");e.length>0&&e[e.length-1].scrollIntoView()}function C(e){p=e}L(),i.addEventListener("click",(function(){return o.style.display="flex"})),l.addEventListener("click",(function(){return o.style.display="none"})),d.addEventListener("click",(function(){var e,t,n=r.value.trim();n&&(e=n,t={id:"chat-".concat(Date.now()),name:e,lastMessage:"",time:"",readStatus:!0},v.push(t),localStorage.setItem("chats",JSON.stringify(v)),h[t.id]=[],localStorage.setItem("messageContainers",JSON.stringify(h)),w(t),location.reload(),o.style.display="none",r.value="")})),c.addEventListener("click",(function(){return function(e,t,n){t.style.display="none",e.style.display="block",n(null)}(a,s,C)})),u.addEventListener("input",(function(){var e=u.value.toLowerCase();document.querySelectorAll(".chat-item").forEach((function(t){var n=t.querySelector("h3").textContent.toLowerCase();t.style.display=n.includes(e)?"block":"none"}))})),m.addEventListener("submit",(function(t){t.preventDefault();var n,a,s,c,i=g.value.trim();if(i&&p){var r=new Date,o=r.toISOString(),d={sender:E,text:i,timestamp:o};h[p].push(d),localStorage.setItem("messageContainers",JSON.stringify(h)),B(p),g.value="",n=p,a=i,s=r,-1!==(c=v.findIndex((function(e){return e.id===n})))&&(v[c].lastMessage=a,v[c].time=e(s),localStorage.setItem("chats",JSON.stringify(v)),L()),b()}})),f.addEventListener("click",(function(){var e=function(e,t,n){return{currentUser:n?"Максим":t,isSwitched:n=!n}}(0,I,S);E=e.currentUser,S=e.isSwitched,B(p)}))}))})();