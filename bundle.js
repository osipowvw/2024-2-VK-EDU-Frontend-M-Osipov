(()=>{"use strict";document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("chat-list"),t=document.getElementById("messages-container"),n=document.getElementById("chat-list-screen"),a=document.getElementById("chat-screen"),c=document.getElementById("back-button"),s=document.getElementById("create-chat-button"),i=document.getElementById("new-chat-name"),o=document.getElementById("create-chat-modal"),d=document.getElementById("create-chat-confirm-button"),r=document.getElementById("create-chat-cancel-button"),l=document.getElementById("search-input"),u=document.getElementById("message-form"),m=document.getElementById("message-input"),g=document.getElementById("switch-user-button"),y=document.getElementById("user-name"),v=JSON.parse(localStorage.getItem("chats"))||[],f=JSON.parse(localStorage.getItem("messageContainers"))||{},p=null,h="Максим",E=!1,I="";function S(){e.innerHTML="",v.forEach((function(e){return L(e)}))}function L(t){var c=document.createElement("div");c.classList.add("chat-item"),c.innerHTML='\n      <div class="chat-info">\n        <h3>'.concat(t.name,"</h3>\n        <p>").concat(t.lastMessage||"Нет сообщений",'</p>\n      </div>\n      <div class="chat-time">').concat(t.time,'</div>\n      <span class="indicator ').concat(t.readStatus?"read":"unread",'"></span>\n    '),e.appendChild(c),c.addEventListener("click",(function(){return e=t.id,c=t.name,p=e,I=c,h="Максим",y.textContent=c,n.style.display="none",a.style.display="block",void B(e);var e,c}))}function B(e){t.innerHTML="",(f[e]||[]).forEach((function(e){var n=function(e){var t=e.sender,n=e.text,a=e.timestamp,c=document.createElement("div");c.classList.add("message"),t===h?c.classList.add("message-right"):c.classList.add("message-left");var s=document.createElement("span");return s.textContent="".concat(t,": ").concat(n," (").concat(C(a),")"),c.appendChild(s),c}(e);t.appendChild(n)}))}function C(e){var t=new Date(e),n=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return"".concat(n,":").concat(a)}S(),s.addEventListener("click",(function(){return o.style.display="flex"})),r.addEventListener("click",(function(){return o.style.display="none"})),d.addEventListener("click",(function(){var e,t,n=i.value.trim();n&&(e=n,t={id:"chat-".concat(Date.now()),name:e,lastMessage:"",time:"",readStatus:!0},v.push(t),localStorage.setItem("chats",JSON.stringify(v)),f[t.id]=[],localStorage.setItem("messageContainers",JSON.stringify(f)),L(t),location.reload(),o.style.display="none",i.value="")})),c.addEventListener("click",(function(){a.style.display="none",n.style.display="block",p=null})),l.addEventListener("input",(function(){var e=l.value.toLowerCase();document.querySelectorAll(".chat-item").forEach((function(t){var n=t.querySelector("h3").textContent.toLowerCase();t.style.display=n.includes(e)?"block":"none"}))})),u.addEventListener("submit",(function(e){e.preventDefault();var t,n,a,c,s=m.value.trim();if(s&&p){var i=new Date,o=i.toISOString(),d={sender:h,text:s,timestamp:o};f[p].push(d),localStorage.setItem("messageContainers",JSON.stringify(f)),B(p),m.value="",t=p,n=s,a=i,-1!==(c=v.findIndex((function(e){return e.id===t})))&&(v[c].lastMessage=n,v[c].time=C(a),localStorage.setItem("chats",JSON.stringify(v)),S())}})),g.addEventListener("click",(function(){h=E?"Максим":I,E=!E,B(p)}))}))})();